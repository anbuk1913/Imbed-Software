<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout-1 Page</title>
  <link rel="icon" href="/images/logo.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
  <style>
    /* Navbar */
    .navbar {
      width: 100%;
      padding: 15px 0;
      box-shadow: 10px 10px 15px rgba(0, 0, 0, 0.5);
    }

    .navbar-brand {
      font-size: 1.5rem;
      font-weight: 700;
      color: #8CBF3A;
    }

    .navbar-nav .nav-link {
      font-weight: 500;
      color: #555;
      font-size: 1rem;
      margin: 0 10px;
    }

    .navbar-nav .nav-link:hover {
      color: #8CBF3A;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    body {
      font-family: 'Source Sans 3', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .checkout-container {
      padding-top: 20px;
      width: 60%;
      margin: 0 auto;
      font-family: Arial, sans-serif;
    }

    /* .steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .step {
      width: 24%;
      text-align: center;
      padding: 10px;
      background-color: #676966;
      color: white;
      border-radius: 5px;
    }

    .step.active {
      background-color: #60862e;
    } */

    /* Checkout Steps */
    .checkout-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .checkout-steps div{
       margin: 0px 3px;
    }

    .step {
      flex: 1;
      text-align: center;
      padding: 10px;
      border-radius: 5px;
      background: #eee;
      color: #333;
    }

    .step {
      background: #676966;      
      color: white;
    }

    .step.active {
      background: #77cb08;
      color: white;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-group input:focus {
      border-color: green;
    }

    .form-group input.error {
      border-color: red;
    }

    textarea.error {
      border-color: red;
    }

    .address-options div {
      margin-bottom: 10px;
    }

    .form-actions {
      display: flex;
      justify-content: space-between;
      margin: 20px 0px;
    }

    .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }

    .btn-primary {
      color: black;
      background-color: #9acf54;
    }

    .btn-primary:hover {
      background-color: #5c9116;
    }

    .btn-secondary {
      background-color: #ccc;
      color: black;
    }

    #postcode::-webkit-inner-spin-button,
    #postcode::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Footer */
    footer {
      background-color: #8CBF3A;
      /* Updated background color */
      color: white;
      /* Ensures text remains readable */
    }

    footer a {
      color: white;
      /* Ensures links in the footer are readable */
      text-decoration: none;
      transition: color 0.3s ease;
    }

    footer a:hover {
      color: #f0f0f0;
      /* Slightly lighter color on hover */
    }

    footer .input-group button {
      background-color: #6A9F2E;
      /* Matches footer tone */
      color: white;
      border: none;
    }

    footer .input-group button:hover {
      background-color: #5A8A27;
      /* Darker hover effect */
    }
  </style>

</head>

<body>
  <!-- Header Section -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="">
          <img src="/images/logo.png" style="width: 30px;">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="/shop">Shop</a></li>
            <li class="nav-item"><a class="nav-link" href="/cart">Cart</a></li>
            <li class="nav-item"><a class="nav-link" href="/wishlist">Wishlist</a></li>
          </ul>
          <!-- User Profile Section -->
          <div class="dropdown ms-3">
            <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userProfileDropdown"
              data-bs-toggle="dropdown" aria-expanded="false">
              <% if(name){ %>
                <img src="/images/profile.png" style="width: 30px; height: 30px; border-radius: 50%;">
                <span class="ms-2">
                  <%= name %>
                </span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userProfileDropdown">
              <li><a class="dropdown-item" href="/profile">My Profile</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href=""
                  onclick="document.getElementById('logoutForm').submit(); return false;">Logout</a></li>
            </ul>
            <% } else {%>
              <img src="/images/profile.png" style="width: 30px; height: 30px; border-radius: 50%;">
              <span class="ms-2">
                <%= name %>
              </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userProfileDropdown">
                <li><a class="dropdown-item" href="/login">Log In</a></li>
              </ul>
              <% } %>
          </div>
          <!-- End of User Profile Section -->
        </div>
      </div>
    </nav>
  </header>
  <form id="logoutForm" action="/logout" method="post" style="display: none;"></form>
  <div class="checkout-container">
    <nav class="checkout-steps">
      <div class="step active">Billing</div>
      <div class="step">Shipping</div>
      <div class="step">Payment</div>
      <div class="step">Review</div>
    </nav>

    <form id="addressForm" action="/checkouttwo" method="post" class="billing-form">
      <h2>Billing Details</h2>

      <div class="form-group">
        <label for="first-name">First Name</label>
        <input type="text" id="first-name" name="firstName">
        <p style="color: red;" class="first-name-error"></p>
      </div>

      <div class="form-group">
        <label for="last-name">Last Name</label>
        <input type="text" id="last-name" name="lastName">
        <p style="color: red;" class="last-name-error"></p>
      </div>

      <div class="form-group">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" maxlength="10">
        <p style="color: red;" class="phone-error"></p>
      </div>

      <h3>Add Address</h3>
      <div class="address-options">
        <div>
          <% addressCollection.forEach((address, index)=> { %>
            <input type="radio" id="<%= address._id %>" name="address" value="<%= address._id %>" <%=index===0 ? 'checked' : '' %> >
            <label for="<%= address._id %>">
              <%= address.doorNo %>, <%= address.street %>, <%= address.city %>, <%= address.district %> - <%= address.pinCode %>
            </label>
            <% }) %>
        </div>
        <div>
          <input type="radio" id="new-address" name="address" value="new">
          <label for="new-address">New Address</label>
        </div>
      </div>

      <div class="new-address-fields">
        <div class="form-group">
          <label for="doorNum">Door Number</label>
          <input type="text" id="door-num" name="doorNum">
          <p style="color: red;" class="door-num-error"></p>
        </div>

        <div class="form-group">
          <label for="street">Street</label>
          <input type="text" id="street" name="street">
          <p style="color: red;" class="street-error"></p>
        </div>

        <div class="form-group">
          <label for="city">Town/City</label>
          <input type="text" id="city" name="city">
          <p style="color: red;" class="city-error"></p>
        </div>

        <div class="form-group">
          <label for="district">District</label>
          <input type="text" id="district" name="district">
          <p style="color: red;" class="district-error"></p>
        </div>

        <div class="form-group">
          <label for="postcode">Postcode</label>
          <input type="number" id="postcode" name="postcode">
          <p style="color: red;" class="postcode-error"></p>
        </div>
      </div>

      <div class="form-group">
        <label for="order-notes">Order Notes</label>
        <textarea id="order-notes" name="orderNotes"
          placeholder="Notes about Delivery, e.g., special notes for delivery."></textarea>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="window.history.back();">Go Back</button>
        <button type="submit" class="btn btn-primary">Continue</button>
      </div>
    </form>
  </div>

  <!-- Footer Section -->
  <footer class="py-5">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h5>Contact Us</h5>
          <p>No 11, bharathiyar street</p>
          <p>Near Gandhi Street,</p>
          <p>Karaikudi Tamilnadu.</p>
          <p>Phone: +91 8148413021</p>
          <p>Email: <a
              href="https://mail.google.com/mail/?view=cm&fs=1&to=imbedsoftwareteam@gmail.com">imbedsoftwareteam@gmail.com</a>
          </p>
        </div>
        <div class="col-md-3">
          <h5>Information</h5>
          <ul class="list-unstyled">
            <li><a href="#">Your Account</a></li>
            <li><a href="#">Free Shipping Policy</a></li>
            <li><a href="#">Return Policy</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5>Support</h5>
          <ul class="list-unstyled">
            <li><a href="#">Payment Method</a></li>
            <li><a href="#">Product Support</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h5>Join Our Mailing List</h5>
          <form>
            <div class="input-group">
              <input type="email" class="form-control" placeholder="Your Email Address">
              <button class="btn btn-dark">→</button>
            </div>
          </form>
          <h5 class="mt-3">Download Our Mobile Apps</h5>
          <a href=""><img src="/images/playstore.webp" alt="App Stores" style="max-width: 100px;"></a>
          <a href=""><img src="/images/appstore.png" alt="App Stores" style="max-width: 110px;margin-left: 20px;"></a>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("addressForm");
      const firstName = document.getElementById("first-name");
      const lastName = document.getElementById("last-name");
      const phone = document.getElementById("phone");
      const newAddressRadio = document.getElementById("new-address");
      const newAddressFields = document.querySelector(".new-address-fields");
      
      // Initially disable new address fields
      newAddressFields.style.display = "none";

      // Enable/disable new address fields based on radio selection
      document.querySelectorAll("input[name='address']").forEach(radio => {
          radio.addEventListener("change", function () {
              if (newAddressRadio.checked) {
                  newAddressFields.style.display = "block";
              } else {
                  newAddressFields.style.display = "none";
              }
          });
      });

      form.addEventListener("submit", function (event) {
          event.preventDefault();
          let isValid = true;

          // Name validation (no spaces, special characters, numbers)
          const nameRegex = /^[A-Za-z]+$/;

          if (!nameRegex.test(firstName.value)) {
              document.querySelector(".first-name-error").textContent = "Invalid first name";
              isValid = false;
          } else {
              document.querySelector(".first-name-error").textContent = "";
          }

          if (!nameRegex.test(lastName.value)) {
              document.querySelector(".last-name-error").textContent = "Invalid last name";
              isValid = false;
          } else {
              document.querySelector(".last-name-error").textContent = "";
          }

          // Phone validation (10-digit number)
          const phoneRegex = /^\d{10}$/;
          if (!phoneRegex.test(phone.value)) {
              document.querySelector(".phone-error").textContent = "Enter a valid 10-digit phone number";
              isValid = false;
          } else {
              document.querySelector(".phone-error").textContent = "";
          }

          

          // If new address is selected, validate address fields
          if (newAddressRadio.checked) {
              const addressFields = ["door-num", "street", "city", "district", "postcode"];
              addressFields.forEach(field => {
                  const input = document.getElementById(field);
                  const errorField = document.querySelector(`.${field}-error`);
                  if (input.value.trim() === "") {
                      errorField.textContent = "This field is required";
                      isValid = false;
                  } else {
                      errorField.textContent = "";
                  }
              });
          }

          if (isValid) {
              form.submit();
          }
      });
  });

  </script>
</body>

</html>